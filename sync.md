# AWS のストレージ操作

ここでは、AWS S3というストレージサービスをオンプレミス計算機から利用する方法を説明する。

S3はオブジェクトストレージと呼ばれるタイプのストレージサービスで、
ファイルをオブジェクトという単位で扱う。
オブジェクトを格納する場所をバケットと呼び、用途に応じて複数作成することが出来る。
バケット内は基本的に階層構造を持たず、フラットにオブジェクトが配置される。
ただし、オブジェクトの名前に接頭辞（プレフィクス）を付けることにより、
Linuxのディレクトリと同様に、同じプレフィクスを持つオブジェクト群をまとめて扱う、
階層的な操作が可能となる。

AWS CLIを用いた S3の操作方法は以下のとおりである。

## S3バケットの作成

```bash
$ aws s3 mb s3://{バケット名}
```

## オンプレミス計算機からS3バケットへのファイルのコピー

```bash
$ aws s3 cp {ファイルのパス} s3://{バケット名}/
```

## S3バケットからオンプレミス計算機へのファイルのコピー

```bash
$ aws s3 cp s3://{バケット名}/{オブジェクト名} {ファイルのパス} 
```

## オンプレミス計算機からS3バケットへのディレクトリの同期

```bash
$ aws s3 sync {ディレクトリのパス} s3://{バケット名}/{プレフィクス名}
```

ディレクトリの中の以下のファイルをS3バケット内のオブジェクトとしてコピーする。
* S3バケットに同名のオブジェクトが存在しないファイル
* S3バケットの同名のオブジェクトとサイズが違うファイル
* S3バケットの同名のオブジェクトより更新時刻が新しいファイル

## S3バケットからオンプレミス計算機へのディレクトリの同期

```bash
$ aws s3 sync s3://{バケット名}/{プレフィクス名}　{ディレクトリのパス} 
```

S3バケットの以下のオブジェクトをディレクトリ内のファイルとしてコピーする。
* ディレクトリに同名のファイルが存在しないオブジェクト
* ディレクトリの同名のファイルとサイズが違うオブジェクト
* ディレクトリの同名のファイルより更新時刻が古いオブジェクト（**古いオブジェクトで新しいファイルが上書きされるので注意**）


